<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VenonRoblox â€“ Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{--bg:#0b0f1a;--card:#12172a;--accent:#5865f2;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937}
    *{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
    body{margin:0;background:var(--bg);color:var(--text)}
    header{border-bottom:1px solid var(--border)}
    .nav{max-width:1200px;margin:auto;padding:16px 32px;display:flex;justify-content:space-between}
    .nav a{color:var(--muted);margin-left:20px;text-decoration:none}
    .nav a:hover{color:var(--text)}
    section{max-width:900px;margin:auto;padding:60px 32px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:28px}
    input,button{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#020617;color:white;margin-top:10px}
    button{background:var(--accent);font-weight:600;cursor:pointer}
    .hidden{display:none}
    .site-box{border:1px dashed var(--border);padding:16px;border-radius:12px;margin-top:12px}
  </style>
</head>
<body>
<header>
  <div class="nav">
    <strong>VenonRoblox</strong>
    <div>
      <a href="#home">Home</a>
      <a href="#login">Login</a>
    </div>
  </div>
</header>

<section id="home">
  <h1>Venon Platform</h1>
  <p class="muted">Login or register to create and manage your Venon site.</p>
</section>

<section id="login" class="card">
  <h2>Login / Register</h2>
  <input id="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>
  <button onclick="register()" style="margin-top:8px">Register</button>
</section>

<section id="dashboard" class="card hidden">
  <h2>Dashboard</h2>
  <p id="userInfo"></p>

  <h3>Create Site</h3>
  <input id="siteName" placeholder="Shop name (used as #hash)" />
  <button onclick="createSite()">Create Site</button>

  <div id="sites"></div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCNY2kHYcYUNVx8ZcnhZN34WZKkGk55bi0",
  authDomain: "venonroblox-291da.firebaseapp.com",
  projectId: "venonroblox-291da",
  storageBucket: "venonroblox-291da.firebasestorage.app",
  messagingSenderId: "208806389418",
  appId: "1:208806389418:web:5eea9b863a79780061d2d3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.login = async () => {
  await signInWithEmailAndPassword(auth, email.value, password.value);
};

window.register = async () => {
  await createUserWithEmailAndPassword(auth, email.value, password.value);
};

window.createSite = async () => {
  const name = siteName.value.trim();
  if (!name) return alert('Invalid name');
  const ref = doc(db, 'sites', auth.currentUser.uid + '_' + name);
  await setDoc(ref, {
    owner: auth.currentUser.uid,
    name,
    created: Date.now()
  });
  loadSites();
};

async function loadSites() {
  sites.innerHTML = '';
  const snap = await getDocs(collection(db, 'sites'));
  snap.forEach(d => {
    if (d.data().owner === auth.currentUser.uid) {
      const div = document.createElement('div');
      div.className = 'site-box';
      div.innerHTML = `<strong>${d.data().name}</strong><br>URL: https://venonweb.netlify.app/#${d.data().name}`;
      sites.appendChild(div);
    }
  });
}

onAuthStateChanged(auth, user => {
  if (user) {
    login.classList.add('hidden');
    dashboard.classList.remove('hidden');
    userInfo.textContent = 'Logged in as ' + user.email;
    loadSites();
  }
});
</script>
</body>
</html>
